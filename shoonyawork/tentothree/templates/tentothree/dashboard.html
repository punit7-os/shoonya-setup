{% extends "base.html" %}

{% block head %}
<title>


Running Dashboard


</title>

<!-- jQuery Script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // Use jQuery noConflict mode to avoid conflicts
    var $jq = jQuery.noConflict();

    $jq(document).ready(function() {
        function refreshDashboard() {
            $jq.ajax({
                url: '',  // This will call the same URL (the current view)
                type: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'  // Indicate AJAX request
                },
                success: function(response) {
                    // Update the last refresh timestamp and the script output
                    $jq('#last-refresh').text(response.timestamp);
                    $jq('#script-output').text(response.output);
                },
                error: function(xhr, status, error) {
                    console.error("AJAX error:", error);
                }
            });
        }

        // Initial load of the dashboard data
        refreshDashboard();

        // Set interval to refresh every 5 minutes (300000 milliseconds)
        setInterval(refreshDashboard, 10000);  // 5 minutes
    });
</script>

<style>
    {% block style %}
    .output_1 {
        color: red;
    }
    
    pre {
        display: block;
        font-size: 99.5%;
        color: #212529;
    }
    {% endblock style %}
</style>

{% endblock head %}

{% block body %}
<div class="container mt-5">
    <!-- Display success message if present (Bootstrap alert) -->
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == "success" %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>

<div class="container">
    <h1 class="text-center">Runner</h1>
    <p>Last refreshed: <span id="last-refresh">{{ timestamp }}</span></p>
    <pre id="script-output">{{ console_output }}</pre><br>

    <!-- Table displaying the records -->
    <table border="1">
        <tbody>
            {% for row in df_records %}
                <tr>
                    <td>{{ row.time }}</td>
                    <td>{{ row.into }}</td>
                    <td>{{ row.inth }}</td>
                    <td>{{ row.intc }}</td>
                    <td>{{ row.ssboe }}</td>
                    <td>{{ row.intv }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Script to close alerts after 4 seconds -->
<script>
    setTimeout(function() {
        let alerts = document.querySelectorAll('.alert-success');
        alerts.forEach(function(alert) {
            let alertInstance = new bootstrap.Alert(alert);
            alertInstance.close();
        });
    }, 4000);  // 4000 milliseconds = 4 seconds
</script>

{% endblock body %}
